import{p as ee,a9 as te,l as oe,aa as le,z as ne,c as p,r as F,x as se,ab as ae,m as n,B as V,a6 as w,ac as N,Z as ie,ad as re,_ as ue,ae as ce,E as r,N as u,O as d,G as de,P as fe,H as pe}from"./index-ee182a8d.js";import{m as he,a as me,u as ve,V as D,f as ge,b as be,c as ye}from"./VInput-4930e2c4.js";import{f as Ce}from"./forwardRefs-db20782f.js";import{V as _e}from"./VChip-31848b87.js";import{b as ke,j as Fe,K as T}from"./VBtn-83d1d92c.js";import"./index-76ade47d.js";import"./VAvatar-dc8d21dd.js";const Ve=ee({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...he({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>te(e).every(i=>i!=null&&typeof i=="object")},...me({clearable:!0})},"VFileInput"),we=oe()({name:"VFileInput",inheritAttrs:!1,props:Ve(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,i){let{attrs:s,emit:C,slots:t}=i;const{t:h}=le(),l=ne(e,"modelValue"),{isFocused:b,focus:j,blur:L}=ve(e),P=p(()=>typeof e.showSize!="boolean"?e.showSize:void 0),B=p(()=>(l.value??[]).reduce((o,a)=>{let{size:m=0}=a;return o+m},0)),I=p(()=>N(B.value,P.value)),_=p(()=>(l.value??[]).map(o=>{const{name:a="",size:m=0}=o;return e.showSize?`${a} (${N(m,P.value)})`:a})),O=p(()=>{var a;const o=((a=l.value)==null?void 0:a.length)??0;return e.showSize?h(e.counterSizeString,o,I.value):h(e.counterString,o)}),S=F(),U=F(),f=F(),W=p(()=>b.value||e.active),z=p(()=>["plain","underlined"].includes(e.variant));function k(){var o;f.value!==document.activeElement&&((o=f.value)==null||o.focus()),b.value||j()}function G(o){R(o)}function H(o){C("mousedown:control",o)}function R(o){var a;(a=f.value)==null||a.click(),C("click:control",o)}function K(o){o.stopPropagation(),k(),ie(()=>{l.value=[],re(e["onClick:clear"],o)})}return se(l,o=>{(!Array.isArray(o)||!o.length)&&f.value&&(f.value.value="")}),ke(()=>{const o=!!(t.counter||e.counter),a=!!(o||t.details),[m,Z]=ae(s),[{modelValue:De,...q}]=D.filterProps(e),[J]=ge(e);return n(D,V({ref:S,modelValue:l.value,"onUpdate:modelValue":v=>l.value=v,class:["v-file-input",{"v-text-field--plain-underlined":z.value},e.class],style:e.style,"onClick:prepend":G},m,q,{centerAffix:!z.value,focused:b.value}),{...t,default:v=>{let{id:y,isDisabled:g,isDirty:x,isReadonly:A,isValid:Q}=v;return n(be,V({ref:U,"prepend-icon":e.prependIcon,onMousedown:H,onClick:R,"onClick:clear":K,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},J,{id:y.value,active:W.value||x.value,dirty:x.value,disabled:g.value,focused:b.value,error:Q.value===!1}),{...t,default:X=>{var M;let{props:{class:Y,...E}}=X;return n(w,null,[n("input",V({ref:f,type:"file",readonly:A.value,disabled:g.value,multiple:e.multiple,name:e.name,onClick:c=>{c.stopPropagation(),A.value&&c.preventDefault(),k()},onChange:c=>{if(!c.target)return;const $=c.target;l.value=[...$.files??[]]},onFocus:k,onBlur:L},E,Z),null),n("div",{class:Y},[!!((M=l.value)!=null&&M.length)&&(t.selection?t.selection({fileNames:_.value,totalBytes:B.value,totalBytesReadable:I.value}):e.chips?_.value.map(c=>n(_e,{key:c,size:"small",color:e.color},{default:()=>[c]})):_.value.join(", "))])])}})},details:a?v=>{var y,g;return n(w,null,[(y=t.details)==null?void 0:y.call(t,v),o&&n(w,null,[n("span",null,null),n(ye,{active:!!((g=l.value)!=null&&g.length),value:O.value},t.counter)])])}:void 0})}),Ce({},S,U,f)}}),Pe={name:"Update",props:[],data(){return{selectedFile:null,uploadProgress:"0",completion:"0%",showFileButton:!0,showUploadButton:!1,showProgressBar:!1,rebooting:!1,interval:{},rebootCompletion:0,rebootPercent:"0%"}},computed:{},methods:{startTimer(){this.interval=setInterval(()=>{this.rebootCompletion=this.rebootCompletion===100?0:this.rebootCompletion+1,this.rebootPercent=`${this.rebootCompletion.toString()}%`,this.rebootCompletion==100&&(this.rebooting=!1,this.$router.push("/"),setTimeout(function(){location.reload()},3e3))},600)},fileSelect(e){this.showFileButton=!1,this.showUploadButton=!0,this.selectedFile=e.target.files[0],console.log(this.selectedFile),console.log(this.showUploadButton)},upload(){const e=`${location.hostname}:1880`,i=new FormData;this.selectedFile==null?alert("No file selected"):this.selectedFile.type=="application/x-tar"&&this.selectedFile.name=="dist.tar"?(this.showFileButton=!1,this.showUploadButton=!1,this.showProgressBar=!0,i.append("image",this.selectedFile),ce.post(`http://${e}/update`,i,{onUploadProgress:s=>{console.log("upload progress:"+Math.round(s.loaded/s.total*100)+"%"),this.completion=Math.round(s.loaded/s.total*100).toString()+"%",this.uploadProgress=Math.round(s.loaded/s.total*100).toString()}}).then(s=>{s.status===200?(this.rebooting=!0,this.startTimer()):alert("fail")}).catch(s=>{this.errors.push(s)})):alert("Wrong file.File should be dist.tar. Please contact info@octavainc.com to get correct file")}},mounted(){},beforeUnmount(){clearInterval(this.interval)}},Be={class:"update"},Ie={key:0},Se={key:1,id:"input"},Ue={key:2,class:"field center-align"},ze={key:3,id:"progress-container"},Re={key:0,class:"progress"},xe={key:1,class:"progressFeedback"},Ae={key:2,class:"progress"},Me={key:3};function Ne(e,i,s,C,t,h){return r(),u("div",Be,[t.rebooting?d("",!0):(r(),u("h5",Ie,"Update")),t.showFileButton?(r(),u("div",Se,[n(we,{onChange:h.fileSelect,id:"file-select-button",label:"File input",variant:"outlined",accept:".tar",color:"white"},null,8,["onChange"])])):d("",!0),t.showUploadButton?(r(),u("div",Ue,[n(Fe,{color:"blue",onClick:h.upload},{default:de(()=>[pe("Upload")]),_:1},8,["onClick"])])):d("",!0),t.showProgressBar?(r(),u("div",ze,[t.rebooting?d("",!0):(r(),u("div",Re,[n(T,{modelValue:t.uploadProgress,"onUpdate:modelValue":i[0]||(i[0]=l=>t.uploadProgress=l),"bg-color":"white",color:"blue"},null,8,["modelValue"])])),t.rebooting?d("",!0):(r(),u("div",xe,"Uploading "+fe(t.completion),1)),t.rebooting?(r(),u("div",Ae,[n(T,{modelValue:t.rebootCompletion,"onUpdate:modelValue":i[1]||(i[1]=l=>t.rebootCompletion=l),"bg-color":"white",color:"green"},null,8,["modelValue"])])):d("",!0),t.rebooting?(r(),u("div",Me," Please Wait. Restarting Controller ")):d("",!0)])):d("",!0)])}const Ke=ue(Pe,[["render",Ne],["__scopeId","data-v-ebbfef30"]]);export{Ke as default};
